
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Previous: <a href='10 - Spring Cloud Config-Get updated config file by manually refresh.html'>10 - Spring Cloud Config-Get updated config file by manually refresh</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>11 - Spring Cloud Config-Get updated config file by dynamic refresh</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><h3>11.1 Dynamic refresh by using Config+Bus</h3></div><div class="cell text-cell"><div>Spring Cloud Bus is also known as the message bus. It can connect various services in the microservice architecture through lightweight message brokers (such as RabbitMQ, Kafka, etc.), and realize broadcast status changes, event push and other functions. It can also realize Communication functions between microservices.</div><div><br></div><div>Currently Spring Cloud Bus supports two message brokers: RabbitMQ and Kafka.</div></div><div class="cell text-cell">Spring Cloud Bus will use a lightweight message broker to build a public message topic Topic (the default is "springCloudBus"), and messages in this Topic will be monitored and consumed by all service instances. When one of the services refreshes the data, Spring Cloud Bus will save the information to the Topic, so that the service listening to this Topic will receive the message and consume it automatically.<div><br></div><div>Many functions can be realized by using the special mechanism of Spring Cloud Bus, and the dynamic refresh of configuration with Spring Cloud Config is one of the most typical application scenarios.<br></div><div><br></div><div>When the configuration in the Git repository changes, we only need to send a POST request to a certain service, and Spring Cloud Bus can notify other services to re-pull through the message proxy. Get the latest configuration to realize the dynamic refresh of the configuration.<br></div><div><br></div><div>The following picture shows how it works:<br></div></div><div class="cell text-cell"><img src="resources/D6359056C93070053E06A8F0B3F2B208.png" alt="WechatIMG17.png" width="910" height="436"></div><div class="cell text-cell"><div>According to picture, using Spring Cloud Bus to implement dynamic configuration refresh requires the following steps:</div><div>(i) When the configuration in the Git warehouse changes, the operation and maintenance personnel send a POST request to the Config server, and the request path is "/actuator/refresh".</div><div>(ii) After receiving the request, the Config server will forward the request to the service bus Spring Cloud Bus.</div><div>(iii) After Spring Cloud Bus receives the message, it will notify all Config clients.</div><div>(iv) The Config client receives the notification and requests the Config server to pull the latest configuration.</div><div>(v) All Config clients get the latest configuration.</div></div><div class="cell text-cell">Let's take RabbitMQ as an example to demonstrate how to use Config+Bus to implement dynamic configuration refresh.</div><div class="cell text-cell"><h3 style="font-size: 16.209999084472656px;"><span style="font-weight: normal;">(1) In pom.xml of micro-service-cloud-config-center-3344, add Spring Boot actuator monitoring module and Spring Cloud Bus dependencies, the code is as follows.</span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_xml">&lt;!--add spring cloud message Bus support for RabbitMQ--&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">dependency</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">groupId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">org.springframework.cloud</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">groupId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">artifactId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">spring-cloud-starter-bus-amqp</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">artifactId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">dependency</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_xml">&lt;!--add Spring Boot actuator dependency--&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">dependency</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">groupId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">org.springframework.boot</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">groupId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">artifactId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">spring-boot-starter-actuator</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">artifactId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">dependency</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div></div></div></div><div class="cell text-cell"><h3><span style="font-weight: normal;">(2)&nbsp;In the configuration file application.yml of micro-service-cloud-config-center-3344, add the relevant configuration of RabbitMQ and Spring Boot actuator, the configuration content is as follows.</span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">##### RabbitMQ related configuration, 15672 is the port of the web management interface, 5672 is the access port of MQ###########</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">##### By default, rabbitmq only have one built-in user, which is guest. But guest user can only be used on localhost. So before we </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">##### deloy on the actual server, we need to creat new user(such as admin) and then give it the access to vhost "/", see details in rabbit mq doc</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">spring</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  rabbitmq</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    host</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">127.0.0.1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    port</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">5672</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment"># username: guest</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    username</span><span class="ace_keyword">: </span>admin
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment"># password: guest</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    password</span><span class="ace_keyword">: </span>admin
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># Spring Boot 2.50 shields most of the nodes for actuator monitoring, and only exposes the heath node. The configuration (*) in this section is to enable all nodes</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">management</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  endpoints</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    web</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  exposure</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">    include</span><span class="ace_keyword">: </span><span class="ace_string">'bus-refresh'</span>
</div></div></div></div><div class="cell text-cell"><h3><span style="font-weight: normal;">(3)&nbsp;In the pom.xml of micro-service-cloud-config-client-3355, add the relevant dependencies of Spring Cloud Bus, the code is as follows.</span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_xml">&lt;!--add spring cloud message Bus support for RabbitMQ--&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">dependency</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">groupId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">org.springframework.cloud</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">groupId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_text ace_xml">    </span><span class="ace_meta ace_tag ace_punctuation ace_tag-open ace_xml">&lt;</span><span class="ace_meta ace_tag ace_tag-name ace_xml">artifactId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span><span class="ace_text ace_xml">spring-cloud-starter-bus-amqp</span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">artifactId</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag ace_punctuation ace_end-tag-open ace_xml">&lt;/</span><span class="ace_meta ace_tag ace_tag-name ace_xml">dependency</span><span class="ace_meta ace_tag ace_punctuation ace_tag-close ace_xml">&gt;</span>
</div></div></div></div><div class="cell text-cell"><h3><span style="font-weight: normal;">(4)&nbsp;Add the following configuration in the configuration file bootstrap.yml of micro-service-cloud-config-client-3355.</span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">spring</span><span class="ace_keyword">: </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  rabbitmq</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    host</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">127.0.0.1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    port</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">5672</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment"># username: guest</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    username</span><span class="ace_keyword">: </span>admin
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment"># password: guest</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    password</span><span class="ace_keyword">: </span>admin
</div></div></div></div><div class="cell text-cell"><h3><span style="font-weight: normal;">(5) Referring to micro-service-cloud-config-client-3355, create a new Spring Boot module named micro-service-cloud-config-client-bus-3366 (port number is 3366), and in its configuration file bootstrap.yml Add the following configuration.</span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#bootstrap.yml is at system level<span class="ace_cjk" style="width:NaNpx">，</span>loading order is prior to application.yml   Responsible for loading configuration from outside and parsing</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">server</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  port</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">3366</span>  <span class="ace_comment">#port num 3366</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">spring</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  application</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    name</span><span class="ace_keyword">: </span>spring-cloud-config-client-bus
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  cloud</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    config</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  label</span><span class="ace_keyword">: </span>main <span class="ace_comment">#branch name</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  name</span><span class="ace_keyword">: </span>config  <span class="ace_comment">#name of the config file, the 'config' in 'config-dev.yml'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  profile</span><span class="ace_keyword">: </span>dev  <span class="ace_comment">#environment name, 'dev'  'config-dev.yml'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_comment">#don't forget to add http here. Otherwise it won't load.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  uri</span><span class="ace_keyword">: </span>http://localhost:<span class="ace_constant ace_numeric">3344</span> <span class="ace_comment">#address of Spring Cloud Config server end</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>  <span class="ace_comment">##### RabbitMQ related configuration, 15672 is the port of the web management interface, 5672 is the access port of MQ###########</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  rabbitmq</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    host</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">127.0.0.1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    port</span><span class="ace_keyword">: </span><span class="ace_constant ace_numeric">5672</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    username</span><span class="ace_keyword">: </span>admin
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    password</span><span class="ace_keyword">: </span>admin
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">eureka</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  client</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    service-url</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  defaultZone</span><span class="ace_keyword">: </span>http://eureka7001.com:<span class="ace_constant ace_numeric">7001</span>/eureka/,http://eureka7002.com:<span class="ace_constant ace_numeric">7002</span>/eureka/,http://eureka7003.com:<span class="ace_constant ace_numeric">7003</span>/eureka/
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  instance</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    instance-id</span><span class="ace_keyword">: </span>config-bus<span class="ace_constant ace_numeric">-3366</span> <span class="ace_comment">#Custom service name information</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># Spring Boot 2.50 screens most of the nodes for actuator monitoring, and only exposes the health node. The configuration (*) in this section is to enable all nodes</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">management</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">  endpoints</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_meta ace_tag">    web</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">  exposure</span><span class="ace_keyword">:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_meta ace_tag">    include</span><span class="ace_keyword">: </span><span class="ace_string">"*"</span>   <span class="ace_comment"># * is a keyword in the yaml file, so quotation marks are required</span>
</div></div></div></div><div class="cell text-cell"><h3><span style="font-weight: normal;"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">(6)&nbsp;</span><span style="font-size: 16px;">Restart microservice-cloud-config-center-3344 and microservice-cloud-config-client-3355 in turn, and use a browser to access "</span><a href="http://localhost:3355/getConfig" style="font-size: 16px;">http://localhost:3355/getConfig</a><span style="font-size: 16px;">” we will get config seccussfully</span></span></h3></div><div class="cell text-cell"><h3><span style="font-weight: normal;"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">(7)&nbsp;</span>Start micro-service-cloud-config-client-bus-3366, use a browser to access "<a href="http://localhost:3366/getConfig">http://localhost:3366/getConfig</a>", the result will be the same with step 6</span></h3></div><div class="cell text-cell"><h3><span style="font-weight: normal;">(8) Now, make some changes in the configuration file in GitHub</span></h3></div><div class="cell text-cell"><h3><span style="font-weight: normal;">(9) Open the command line window and use the following command to send a POST request to micro-service-cloud-config-center-3344 (Config Server) to refresh the configuration.</span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">curl</span> <span class="ace_keyword ace_operator">-</span><span class="ace_identifier">X</span> <span class="ace_identifier">POST</span> <span class="ace_string">"http://localhost:3344/actuator/bus-refresh"</span>
</div></div></div></div><div class="cell text-cell"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">(10)&nbsp;</span><span style="font-size: 16px;">Visit "</span><a href="http://localhost:3355/getConfig" style="font-size: 16px;">http://localhost:3355/getConfig</a><span style="font-size: 16px;">" again with a browser, now you should see the latest config that has been changed in step 8</span><br style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;"></div><div class="cell text-cell"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">(11)&nbsp;</span><span style="font-size: 16px;">Visit</span><span style="font-size: 16px; orphans: 2; widows: 2;">&nbsp;"</span><a href="http://localhost:3366/getConfig" style="font-size: 16px; orphans: 2; widows: 2;">http://localhost:3366/getConfig</a><span style="font-size: 16px; orphans: 2; widows: 2;">"again with a browser, you’ll get the same result with step 10.</span></div><div class="cell text-cell"><div style="orphans: 2; widows: 2; font-size: 16px;"><br></div></div><div class="cell text-cell"><h3>11.2 Fixed-point notification</h3></div><div class="cell text-cell">The so-called fixed-point notification means that not all Config clients will be notified, but only one of the Config clients will be notified according to the needs.<div>The method of using Spring Cloud Bus to implement fixed-point notification is very simple, as long as we use the following format when sending POST requests.</div></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>http://{hostname}:{port}/actuator/bus-refresh/{destination}
</div></div></div></div><div class="cell text-cell"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">The parameters are described as follows:</span><ul style="margin-top: 0px; margin-bottom: 0px; list-style-position: initial; list-style-image: initial; margin-left: 0px; padding-left: 20px; color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;"><li>{hostname}: Indicates the host address of the Config server, which can be either a domain name or an IP address.</li><li>{port}: indicates the port number of the Config server.</li><li>{destination}: Indicates the Config client (microservice) that needs fixed-point notification, consisting of the service name (spring.application.name) + port number (server.port) of the Config client, for example, only micro-service-cloud-config is notified -client-3355 refresh configuration, the value is spring-cloud-config-client:3355.</li></ul></div><div class="cell text-cell"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">Let's use a simple example to demonstrate the fixed-point notification of Spring Cloud Bus dynamic refresh.</span><br style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;"></div><div class="cell text-cell"><h3><span style="font-weight: normal;"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">(1)&nbsp;</span><span style="caret-color: rgb(68, 68, 68); color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);">make some changes again in the configuration file in GitHub</span></span></h3></div><div class="cell text-cell"><h3><span style="font-weight: normal;"><span style="color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); text-decoration-thickness: initial;">(2)&nbsp;</span><span style="caret-color: rgb(68, 68, 68); color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, 微软雅黑, &quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif; font-size: 17px; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);">Open the command line window and use the following command to send a POST request to micro-service-cloud-config-center-3344 (Config Server) to refresh the configuration.</span></span></h3></div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">curl</span> <span class="ace_keyword ace_operator">-</span><span class="ace_identifier">X</span> <span class="ace_identifier">POST</span> <span class="ace_string">"http://localhost:3344/actuator/bus-refresh/spring-cloud-config-client:3355"</span>
</div></div></div></div><div class="cell text-cell"><h3><span style="font-weight: normal;"><font color="#444444" face="Helvetica Neue, 微软雅黑, Microsoft Yahei, Helvetica, Arial, sans-serif"><span style="font-size: 17px;">(3)&nbsp;</span></font><span style="color: rgb(51, 51, 51); font-family: -apple-system, Helvetica, Arial, sans-serif;">Visit</span></span><span style="font-weight: normal; font-size: 14px;">&nbsp;</span><span style="font-weight: normal; font-size: 15px;">"</span><a href="http://localhost:3355/getConfig" style="font-weight: normal; font-size: 15px;">http://localhost:3355/getConfig</a><span style="font-weight: normal; font-size: 15px;">" with a browser, you’ll see the config has already been changed.</span></h3></div><div class="cell text-cell"><h3 style="font-size: 15.209999084472656px;"><span style="font-weight: normal;"><font color="#444444" face="Helvetica Neue, 微软雅黑, Microsoft Yahei, Helvetica, Arial, sans-serif"><span style="caret-color: rgb(68, 68, 68); font-size: 17px; background-color: rgb(255, 255, 255);">(4)&nbsp;</span></font>Visit "<a href="http://localhost:3366/getConfig">http://localhost:3366/getConfig</a>” with a browser, you’ll see the config remains unchanged.</span></h3></div><div class="cell text-cell"></div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 37) window.location.href = '10 - Spring Cloud Config-Get updated config file by manually refresh.html';
}</script>
    </body>
    </html>
  